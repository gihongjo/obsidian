# 7장 IP 프로토콜

---

# 네트워크 계층의 기능

## 네트워크 계층의 주요 기능 (L3)

- 라우팅
    
- 혼잡 제어
    
    - 패킷의 수가 과도하게 증가하는 현상을 제어하는 것
- 패킷
    
    - 분할: 큰 패킷을 여러 작은 패킷으로 나누는 과정
    - 병합: 목적지에서 분할된 패킷을 다시 모으는 과정
- 연결형 서비스와 비연결형 서비스의 차이는?
    
    - 패킷이 연결된 설정을 따라가느냐 여부
- 비연결형 서비스
    
    - 패킷 전달 순서, 분실 여부 등 연결형 서비스보다 신뢰성이 떨어지는 전송방식
        - 더 많은 오류제어, 흐름제어 기능을 수행해야 함
        - 도착한 순서 번호가 일정하지 않으면 → L4 전송 계층에서 패킷 순서를 재조정 해야 한다.
            - 예) IP 프로토콜의 UDP
- 연결형 서비스
    
    - 패킷을 전송하기 전에 연결 설정을 미리하는 신뢰성이 높은 전송 방식
        - 패킷이 연결 설정된 경로로 모두 동일하게 전송됨
        - 순서 번호가 뒤틀리지 않음
        - 예) IP 프로토콜의 TCP
        

---

# 라우팅 프로토콜

- 라우팅: 입력 패킷에 대한 출력 경로를 결정하는 것
    
- 가상 회선 방식
    
    - 연결이 될 때 한번만 결정하고 이후 모든 패킷이 동일한 경로로 전송됨
- 데이터 그램 방식
    
    - 연결 설정 과정이 없고, 독립적으로 전달 경로를 선택해줘야 함
- 패킷 전송 경로 결정시 고려할 사항
    
    - 모든 전송 패킷에 대해 라우팅 과정이 공평해야 함
    - 효율성 측면에서 패킷의 평균 지연 시간, 전체 네트워크의 성능, 라우터 수의 최소화

### 정적 - 동적 라우팅

- 정적 라우팅
    - 경로 정보를 미리 라우터에 저장하는 방식
    - 네트워크에 변화가 생기면 대응이 어려움
    - 실시간 혼잡도를 반영하기 어려움
- 동적 라우팅
    - 상황에 따라 경로를 변경하는 방식
    - 현재의 네트워크 상황을 고려해 최적 경로를 제공함
    - 경로 정보 수집/관리가 복잡하고, 라우팅 정보 관리가 네트워크에 또다른 부하를 줌
    - 이웃 라우터의 존재 유무와 전송 시간 확인이 필요하다
    - 라우터의 획득한 경로 정보를 이웃 라우터와 공유/갱신

### HELLO/ECHO 패킷

- HELLO 패킷:
    - 라우터의 초기화 과정에서 이웃 라우터의 경로 정보를 파악하는 것
- ECHO 패킷:
    - 라우터 사이의 전송 시간을 측정하는 것
    - 이런 과정을 반복하고, 측정 값의 평균을 구해 이웃 라우터 까지의 전송 지연 시간을 유추함
- A라우터가 B라우터에 정보를 공유 시 개별 라우터의 갱신 시간이 일치하지 않아 내부 경로 정보를 일관성 있게 유지하기 어려움

### 라우팅 테이블

- 라우터들의 적절한 경로 정보가 저장된 곳
    - 다음 홉에 위치한 라우터의 주소를 기록함

### 라우팅 정보의 처리

- 네트워크의 현재 상황을 반영할 수 있도록 관리
    - **소스 라우팅**
        - 패킷 스스로가 수신 호스트까지의 전달 경로 정보를 결정하여 저장하는 방식,
        - 라우팅 테이블 관리 필요 없음
        - 가상회선/데이터그램 방식 모두 사용 가능
    - **분산 라우팅**
        - 라우팅 정보가 분산된 방식
        - 데이터 그램 방식에서 많이 활용
        - 패킷의 전송 경로상의 라우터가 네트워크의 동적인 상황을 적절히 반영함
    - **중앙 라우팅**
        - RCC(Routing Control Center)라는 특별한 호스트가 전송 경로에 관한 모든 정보를 관리
        - 네트워크 규모가 커지면 RCC의 부하가 커짐
        - 소스 라우팅과 동일한 원리로 패킷 전송
    - **계층 라우팅**
        - 분산 라우팅+중앙 라우팅
        - 네트워크 규모가 커져도 효과적임

### 혼잡 제어

- 혼잡이 발생하는 원인
    
    - 패킷 입력이 많아짐 → 많은 패킷이 버퍼에 쌓임 → 패킷 손실 발생 → 타임아웃 기능을 통해 재전송하는 패킷 양이 많아짐 → 악순환

- 혼잡 해결 방안
    
    - 일반적으로 송신 호스트의 타임아웃 시간을 늘림
    - 수신 패킷에 대한 개별 응답도 혼잡에 영향을 줌 → 피기 배깅 방식(완전한 대응 방식은 아님)
    - 혼잡이 적은 경로로 안내하는 라우팅 알고리즘
    - 패킷 생존시간 TimeToLive 를 통한 제어

- 트래픽 성형을 이용한 혼잡제어
    
    - 네트워크로 유입되는 패킷의 분포를 미리 알아두면 순간적인 과도한 트래픽에 대응할 수 있음
    - 리키 버킷 알고리즘: 깔때기가 유입되는 트래픽을 제어
        - 가변율 입력 → 버퍼 → 고정률 출력

- 가상회선을 이용한 혼잡제어
    
    - 혼잡 발생 시 패킷의 전송경로를 조정해 혼잡한 경로로 전송하지 않음

- 자원 예약 방식을 이용한 혼잡제어
    
    - 호스트와 서브넷의 가상 회선 연결을 미리 할당 받음
    - 불필요한 통신 자원 낭비

- ECN (Explicit Congestion Notification)을 이용한 혼잡 제어
    
    - 라우터 자신의 출력 선로 방향으로 전송되는 트래픽 양을 모니터하여 한계치를 초과하면 주의 표시 함
    - ECN 주의 패킷을 전달 받은 송신 호스트는 정해진 비율에 따라 송신 패킷의 양을 줄여서 전송해야 함

- OSFP (Open Short Path First) 최단 경로 우선 프로토콜
    
    - Link State Routing 프로토콜 기방의 LSDB(Link State DataBase)를 구축하고 Dijkstra 알고리즘(최단 경로 알고리즘)을 이용하여 패킷이 목적지로 도달하기까지 최소 경로를 제공하는 라우팅 방식
        - 경로상 라우터의 개수: 홉 수
        - 패킷의 전송 지연 시간, 전송 대역폭, 통신 비용 등
    - Flooding: 수신되는 포트를 제외한 출력 가능한 모든 경로로 중개하는 방식
        - OSPF 라우터가 LSA(Link State Advertisement) 패킷 (OSPF 링크 상태 정보)을 받으면 LSDB에 정보가 없으면 등록
        - 다시 이웃 라우터로 Flooding 되어 전달됨

- DVRP(Distance Vecter Routing Protocol) 거리 백터 라우팅 프로토콜
    
    - 이웃 라우터가 주기적으로 주는 정보에 의존해 BF 알고리즘을 이용하여 라우팅 경로를 결정하는 방식
        - DB알고리즘: 매 단계마다 간선을 전부 확인하여 모든 노드간의 최단 거리를 구함
        - 일반적으로 간선의 가중치가 양수이면 다익스트라, 음수면 BF알고리즘을 사용
    - 거리벡터 알고리즘의 필수 정보
        - 링크 벡터:
            - 이웃 네트워크에 대한 연결정보
            - 링크 벡터 L(x)=[port1, port2, port3 …. portN]
            - 링크벡터에 보관된 정보: 라우터 x에 할당한 라우터 포트 번호
        - 거리 벡터:
            - 개별 네트워크까지의 거리 정보
            - 거리벡터 D(x)= [거리(1),거리(2),거리(3),거리(4)]
            - 전체 네트워크에 소속된 
        - 다음 홉 벡터
            - 개별 네트워크로 가기위한 다음 홉 정보
            - 

---

# IP 프로토콜